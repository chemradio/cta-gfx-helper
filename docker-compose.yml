version: '3.9'
services:
  db:
    restart: always
    hostname: db
    image: mongo:latest
    # expose:
    #   - 27017
  dispatcher:
    restart: always
    build: ./dispatcher_engine
    volumes:
      - ./dispatcher_engine:/usr/src/app
    platform: linux/arm64
    depends_on:
    - db
    environment:
      IS_DOCKER: 1
      BOT_ADMIN_EMAIL: ${BOT_ADMIN_EMAIL}
      BOT_ADMIN_PASSWORD: ${BOT_ADMIN_PASSWORD}
      BOT_ADMIN: ${BOT_ADMIN}
      BOT_TOKEN: ${BOT_TOKEN}
      JWT_SECRET: ${JWT_SECRET}
      REGISTER_PASSPHRASE: ${REGISTER_PASSPHRASE}
    hostname: dispatcher
    ports:
      - "9000:9000"
  # front-svelte:
  #   restart: always
  #   build: ./front_svelte
  #   platform: linux/arm64
  #   depends_on:
  #   - dispatcher
  #   hostname: front_svelte
  #   ports:
  #     - "80:80"
  bot-engine:
    restart: always
    build: ./bot_engine
    volumes:
      - ./bot_engine:/usr/src/app
    platform: linux/arm64
    environment:
      IS_DOCKER: 1
      BOT_ADMIN: ${BOT_ADMIN}
      BOT_TOKEN: ${BOT_TOKEN}
    depends_on:
    - dispatcher
    hostname: bot_engine
  telegram_sender:
    build: ./sender_engine
    depends_on:
    - dispatcher
    hostname: sender
    volumes:
    - ./sender_engine:/usr/src/app
  screenshot-selenium:
    restart: always
    hostname: screenshot_selenium
    image: seleniarm/standalone-chromium
    privileged: true
    shm_size: 2g
  screenshoter:
    restart: always
    build: ./screenshot_engine
    volumes:
      - ./screenshot_engine:/usr/src/app
    platform: linux/arm64
    environment:
      IS_DOCKER: 1
    depends_on:
    - dispatcher
    hostname: screenshoter
  storage-unit:
    restart: always
    build: ./storage_unit
    platform: linux/arm64
    environment:
      IS_DOCKER: 1
    depends_on:
    - dispatcher
    hostname: storage_unit
  video-gfx:
    restart: always
    build: ./video_gfx
    platform: linux/arm64
    environment:
      IS_DOCKER: 1
    depends_on:
    - dispatcher
    hostname: video_gfx
    volumes:
      - ./video_gfx:/usr/src/app
    shm_size: 3g
  video-gfx-selenium-1:
    restart: always
    hostname: video_gfx_selenium_one
    image: seleniarm/standalone-chromium
    privileged: true
    shm_size: 3g
  video-gfx-selenium-2:
    restart: always
    hostname: video_gfx_selenium_two
    image: seleniarm/standalone-chromium
    privileged: true
    shm_size: 3g
  video-gfx-selenium-3:
    restart: always
    hostname: video_gfx_selenium_three
    image: seleniarm/standalone-chromium
    privileged: true
    shm_size: 3g
